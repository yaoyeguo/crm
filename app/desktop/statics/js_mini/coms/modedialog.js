(function(){var f=this.ModeDialog=new Class({Implements:[Options,Events],options:{onLoad:$empty,onShow:$empty,onHide:$empty,onCallback:$empty,params:{url:null,name:null,type:null},title:"title",handle:null,width:800,height:600,resizable:true},initialize:function(b,a){if(b){this.setOptions(a);a=this.options;a.resizable=a.resizable?"yes":"no";if(a.handle)this.handle=$(a.handle);var c;c="dialogWidth={width}px;dialogHeight={height}px;resizable={resizable};status=no".substitute(a);this.returnValue=window.showModalDialog(b,
this,c);this.isSubmit&&this.onClose.call(this,this.returnValue)}},onLoad:function(b){this.win=b;this.doc=this.win.document;this.fireEvent("load",[this,this.options.pname,this.options.params]);this.onShow.call(this)},submit:function(){},onShow:function(){this.fireEvent("show");this.doc.getElement(".dialogBtn")&&this.doc.getElement(".dialogBtn").addEvent("click",function(){try{this.submit.call(this,this.win)}catch(b){}this.win.close();this.isSubmit=true}.bind(this))},onClose:function(b){this.fireEvent("hide",
[b])}});finderDialog=new Class({Extends:f,options:{onLoad:function(){if($(this.handle)){var b=$(this.handle).getParent().getElement("input[type=hidden]").value;if(b){var a=this.doc.getElement("form[id^=finder-form-]");a.store("rowselected",b.split(","));this.win.fireEvent("resize");a.id.slice(-6)}}},onHide:function(b){if(b&&b.length){for(var a=new Element("div"),c=document.createDocumentFragment(),d=this.options.params,e=0,h=b.length;e<h;e++)c.appendChild(new Element("input",{type:"hidden",name:d.name,
value:b[e]}));a.appendChild(c);c=d.postdata?a.toQueryString()+"&"+d.postdata:a.toQueryString();(new Request({url:d.url,onSuccess:function(g){a.destroy();d.type&&this.options.select(d,g,b);this.fireEvent("callback",g)}.bind(this)})).send(c)}},select:function(b,a,c){if(b.type=="radio"){if(JSON.decode(a))$(this.handle).tagName==="INPUT"?$(this.handle).value=JSON.decode(a).name:$(this.handle).setText(JSON.decode(a).name)}else if(b.type=="checkbox")$(this.handle).innerHTML=a;$(this.handle).getParent().getElement("input[type=hidden]").value=
c}},submit:function(b){var a=this.doc.getElement("form[id^=finder-form-]").retrieve("rowselected","");if(a&&a.length)b.returnValue=a.toString().split(",")}});imgDialog=new Class({Extends:f,options:{onCallback:function(b,a){var c=$(this.handle).getParent(".image-input"),d=c.getElement("input");c=c.getElement("img");c.removeProperties("width","height");d.value=b;c.src=a}},imgcallback:function(b,a){this.isSubmit=true;this.fireEvent("callback",[b,a]);this.win.close()}})})();